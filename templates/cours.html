{% extends 'base.html' %}

{% block title %}Cours{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Cours</h1>
    {% if current_user.is_authenticated and current_user.role == 2 %}
        <a href="{{ url_for('creer_cours') }}" class="btn btn-primary">Créer un nouveau cours</a>
    {% endif %}
</div>

<div class="container">
    <!-- Barre de recherche -->
    <form id="searchForm">
        <input type="text" id="searchInput" class="form-control mb-3" placeholder="Rechercher un cours...">
    </form>

    <!-- Affichage des cours par catégorie -->
    {% for categorie, cours_list in cours_par_categorie.items() %}
    <h2>{{ categorie }}</h2>
    <div class="row">
        {% for cours in cours_list %}
        <div class="col-md-4 mb-3">
            <div class="card h-100">
                <div class="card-body">
                    <a href="{{ url_for('detail_cours', uid_cours=cours.uid_cours) }}" class="stretched-link text-decoration-none">
                        <h5 class="card-title text-dark">{{ cours.titre_cours }}</h5>
                    </a>
                    <p class="card-text">{{ cours.description_cours | truncate(50) }}</p>
                    <p class="text-muted">Catégorie: {{ cours.categorie.nom }}</p>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endfor %}
</div>

<!-- JavaScript pour la recherche en temps réel -->
<script>
    // Fonction de recherche
    function searchCours() {
        // Récupérer la valeur de recherche depuis l'input
        var searchText = document.getElementById("searchInput").value.toLowerCase();
        // Sélectionner tous les titres de cours
        var coursTitles = document.querySelectorAll(".card-title");
        // Parcourir tous les titres de cours
        for (var i = 0; i < coursTitles.length; i++) {
            var title = coursTitles[i].innerText.toLowerCase();
            var parentCard = coursTitles[i].closest(".card");
            // Vérifier si le titre correspond à la recherche
            if (title.includes(searchText)) {
                // Afficher la carte si le titre correspond
                parentCard.style.display = "block";
            } else {
                // Masquer la carte si le titre ne correspond pas
                parentCard.style.display = "none";
            }
        }
    }

    // Ajouter un écouteur d'événement sur la saisie de l'utilisateur
    document.getElementById("searchInput").addEventListener("input", searchCours);
</script>

{% endblock %}
